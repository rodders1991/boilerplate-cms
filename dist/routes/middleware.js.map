{"version":3,"sources":["../../src/routes/middleware.js"],"names":["initLocals","req","res","next","locals","navLinks","label","key","href","user","flashMessages","info","flash","success","warning","error","messages","some","msgs","length","requireUser","redirect"],"mappings":";;;;;;;AAAA;;;;;;AAGA;;;AAGO,IAAMA,kCAAa,SAAbA,UAAa,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC7CD,KAAIE,MAAJ,CAAWC,QAAX,GAAsB,CACrB,EAAEC,OAAO,MAAT,EAAiBC,KAAK,MAAtB,EAA8BC,MAAM,GAApC,EADqB,EAErB,EAAEF,OAAO,SAAT,EAAoBC,KAAK,SAAzB,EAAoCC,MAAM,UAA1C,EAFqB,CAAtB;AAIAN,KAAIE,MAAJ,CAAWK,IAAX,GAAkBR,IAAIQ,IAAtB;AACAN;AACA,CAPM;;AAUP;;;AAGO,IAAMO,wCAAgB,uBAACT,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChD,KAAIO,gBAAgB;AACnBC,QAAMV,IAAIW,KAAJ,CAAU,MAAV,CADa;AAEnBC,WAASZ,IAAIW,KAAJ,CAAU,SAAV,CAFU;AAGnBE,WAASb,IAAIW,KAAJ,CAAU,SAAV,CAHU;AAInBG,SAAOd,IAAIW,KAAJ,CAAU,OAAV;AAJY,EAApB;AAMAV,KAAIE,MAAJ,CAAWY,QAAX,GAAsB,iBAAEC,IAAF,CAAOP,aAAP,EAAsB,UAAUQ,IAAV,EAAgB;AAAE,SAAOA,KAAKC,MAAZ;AAAqB,EAA7D,IAAiET,aAAjE,GAAiF,KAAvG;AACAP;AACA,CATM;;AAYP;;;AAGO,IAAMiB,oCAAc,SAAdA,WAAc,CAACnB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC9C,KAAI,CAACF,IAAIQ,IAAT,EAAe;AACdR,MAAIW,KAAJ,CAAU,OAAV,EAAmB,qCAAnB;AACAV,MAAImB,QAAJ,CAAa,kBAAb;AACA,EAHD,MAGO;AACNlB;AACA;AACD,CAPM","file":"middleware.js","sourcesContent":["import _ from 'lodash';\n\n\n/**\n\tInitialises the standard view locals\n*/\nexport const initLocals = (req, res, next) => {\n\tres.locals.navLinks = [\n\t\t{ label: 'Home', key: 'home', href: '/' },\n\t\t{ label: 'Contact', key: 'contact', href: '/contact' },\n\t];\n\tres.locals.user = req.user;\n\tnext();\n};\n\n\n/**\n\tFetches and clears the flashMessages before a view is rendered\n*/\nexport const flashMessages = (req, res, next) => {\n\tvar flashMessages = {\n\t\tinfo: req.flash('info'),\n\t\tsuccess: req.flash('success'),\n\t\twarning: req.flash('warning'),\n\t\terror: req.flash('error'),\n\t};\n\tres.locals.messages = _.some(flashMessages, function (msgs) { return msgs.length; }) ? flashMessages : false;\n\tnext();\n};\n\n\n/**\n\tPrevents people from accessing protected pages when they're not signed in\n */\nexport const requireUser = (req, res, next) => {\n\tif (!req.user) {\n\t\treq.flash('error', 'Please sign in to access this page.');\n\t\tres.redirect('/keystone/signin');\n\t} else {\n\t\tnext();\n\t}\n};\n"]}