{"version":3,"sources":["../../src/routes/middleware.js"],"names":["initLocals","req","res","next","locals","navLinks","label","key","href","user","flashMessages","info","flash","success","warning","error","messages","some","msgs","length","requireUser","redirect"],"mappings":";;;;;;;AAAA;;;;AAGA;;;AAGO,IAAMA,aAAa,SAAbA,UAAa,CAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC7CD,MAAIE,MAAJ,CAAWC,QAAX,GAAsB,CACrB;AAAEC,WAAO,MAAT;AAAiBC,SAAK,MAAtB;AAA8BC,UAAM;AAApC,GADqB,EAErB;AAAEF,WAAO,SAAT;AAAoBC,SAAK,SAAzB;AAAoCC,UAAM;AAA1C,GAFqB,CAAtB;AAIAN,MAAIE,MAAJ,CAAWK,IAAX,GAAkBR,IAAIQ,IAAtB;AACAN;AACA,CAPM;AAUP;;;;;;;AAGO,IAAMO,gBAAgB,uBAACT,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChD,MAAIO,gBAAgB;AACnBC,UAAMV,IAAIW,KAAJ,CAAU,MAAV,CADa;AAEnBC,aAASZ,IAAIW,KAAJ,CAAU,SAAV,CAFU;AAGnBE,aAASb,IAAIW,KAAJ,CAAU,SAAV,CAHU;AAInBG,WAAOd,IAAIW,KAAJ,CAAU,OAAV;AAJY,GAApB;AAMAV,MAAIE,MAAJ,CAAWY,QAAX,GAAsB,gBAAEC,IAAF,CAAOP,aAAP,EAAsB,UAAUQ,IAAV,EAAgB;AAAE,WAAOA,KAAKC,MAAZ;AAAqB,GAA7D,IAAiET,aAAjE,GAAiF,KAAvG;AACAP;AACA,CATM;AAYP;;;;;;;AAGO,IAAMiB,cAAc,SAAdA,WAAc,CAACnB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC9C,MAAI,CAACF,IAAIQ,IAAT,EAAe;AACdR,QAAIW,KAAJ,CAAU,OAAV,EAAmB,qCAAnB;AACAV,QAAImB,QAAJ,CAAa,kBAAb;AACA,GAHD,MAGO;AACNlB;AACA;AACD,CAPM","file":"middleware.js","sourcesContent":["import _ from 'lodash';\n\n\n/**\n\tInitialises the standard view locals\n*/\nexport const initLocals = (req, res, next) => {\n\tres.locals.navLinks = [\n\t\t{ label: 'Home', key: 'home', href: '/' },\n\t\t{ label: 'Contact', key: 'contact', href: '/contact' },\n\t];\n\tres.locals.user = req.user;\n\tnext();\n};\n\n\n/**\n\tFetches and clears the flashMessages before a view is rendered\n*/\nexport const flashMessages = (req, res, next) => {\n\tvar flashMessages = {\n\t\tinfo: req.flash('info'),\n\t\tsuccess: req.flash('success'),\n\t\twarning: req.flash('warning'),\n\t\terror: req.flash('error'),\n\t};\n\tres.locals.messages = _.some(flashMessages, function (msgs) { return msgs.length; }) ? flashMessages : false;\n\tnext();\n};\n\n\n/**\n\tPrevents people from accessing protected pages when they're not signed in\n */\nexport const requireUser = (req, res, next) => {\n\tif (!req.user) {\n\t\treq.flash('error', 'Please sign in to access this page.');\n\t\tres.redirect('/keystone/signin');\n\t} else {\n\t\tnext();\n\t}\n};\n"]}