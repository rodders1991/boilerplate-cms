{"version":3,"sources":["../../../src/routes/views/contact.js"],"names":["keystone","Enquiry","list","exports","module","req","res","view","View","locals","section","enquiryTypes","fields","enquiryType","ops","formData","body","validationErrors","enquirySubmitted","on","action","next","newEnquiry","model","updater","getUpdateHandler","process","flashErrors","errorMessage","err","errors","render"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AACA,MAAMC,UAAUD,SAASE,IAAT,CAAc,SAAd,CAAhB;;AAEAC,UAAUC,OAAOD,OAAP,GAAiB,CAACE,GAAD,EAAMC,GAAN,KAAc;AAExC,MAAIC,OAAO,IAAIP,SAASQ,IAAb,CAAkBH,GAAlB,EAAuBC,GAAvB,CAAX;AACA,MAAIG,SAASH,IAAIG,MAAjB,CAHwC,CAKxC;;AACAA,SAAOC,OAAP,GAAiB,SAAjB;AACAD,SAAOE,YAAP,GAAsBV,QAAQW,MAAR,CAAeC,WAAf,CAA2BC,GAAjD;AACAL,SAAOM,QAAP,GAAkBV,IAAIW,IAAJ,IAAY,EAA9B;AACAP,SAAOQ,gBAAP,GAA0B,EAA1B;AACAR,SAAOS,gBAAP,GAA0B,KAA1B,CAVwC,CAYxC;;AACAX,OAAKY,EAAL,CAAQ,MAAR,EAAgB;AAAEC,YAAQ;AAAV,GAAhB,EAAuCC,QAAQ;AAE9C,QAAIC,aAAa,IAAIrB,QAAQsB,KAAZ,EAAjB;AACA,QAAIC,UAAUF,WAAWG,gBAAX,CAA4BpB,GAA5B,CAAd;AAEAmB,YAAQE,OAAR,CAAgBrB,IAAIW,IAApB,EAA0B;AACzBW,mBAAa,IADY;AAEzBf,cAAQ,0CAFiB;AAGzBgB,oBAAc;AAHW,KAA1B,EAIG,UAAUC,GAAV,EAAe;AACjB,UAAIA,GAAJ,EAAS;AACRpB,eAAOQ,gBAAP,GAA0BY,IAAIC,MAA9B;AACA,OAFD,MAEO;AACNrB,eAAOS,gBAAP,GAA0B,IAA1B;AACA;;AACDG;AACA,KAXD;AAYA,GAjBD;AAmBAd,OAAKwB,MAAL,CAAY,SAAZ;AACA,CAjCD","file":"contact.js","sourcesContent":["import keystone from 'keystone';\nconst Enquiry = keystone.list('Enquiry');\n\nexports = module.exports = (req, res) => {\n\n\tvar view = new keystone.View(req, res);\n\tvar locals = res.locals;\n\n\t// Set locals\n\tlocals.section = 'contact';\n\tlocals.enquiryTypes = Enquiry.fields.enquiryType.ops;\n\tlocals.formData = req.body || {};\n\tlocals.validationErrors = {};\n\tlocals.enquirySubmitted = false;\n\n\t// On POST requests, add the Enquiry item to the database\n\tview.on('post', { action: 'contact' }, next => {\n\n\t\tvar newEnquiry = new Enquiry.model();\n\t\tvar updater = newEnquiry.getUpdateHandler(req);\n\n\t\tupdater.process(req.body, {\n\t\t\tflashErrors: true,\n\t\t\tfields: 'name, email, phone, enquiryType, message',\n\t\t\terrorMessage: 'There was a problem submitting your enquiry:',\n\t\t}, function (err) {\n\t\t\tif (err) {\n\t\t\t\tlocals.validationErrors = err.errors;\n\t\t\t} else {\n\t\t\t\tlocals.enquirySubmitted = true;\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t});\n\n\tview.render('contact');\n};\n"]}