{"version":3,"sources":["../../../src/routes/views/contact.js"],"names":["Enquiry","list","exports","module","req","res","view","View","locals","section","enquiryTypes","fields","enquiryType","ops","formData","body","validationErrors","enquirySubmitted","on","action","newEnquiry","model","updater","getUpdateHandler","process","flashErrors","errorMessage","err","errors","next","render"],"mappings":";;AAAA;;;;;;AACA,IAAMA,UAAU,mBAASC,IAAT,CAAc,SAAd,CAAhB;;AAEAC,UAAUC,OAAOD,OAAP,GAAiB,UAACE,GAAD,EAAMC,GAAN,EAAc;;AAExC,KAAIC,OAAO,IAAI,mBAASC,IAAb,CAAkBH,GAAlB,EAAuBC,GAAvB,CAAX;AACA,KAAIG,SAASH,IAAIG,MAAjB;;AAEA;AACAA,QAAOC,OAAP,GAAiB,SAAjB;AACAD,QAAOE,YAAP,GAAsBV,QAAQW,MAAR,CAAeC,WAAf,CAA2BC,GAAjD;AACAL,QAAOM,QAAP,GAAkBV,IAAIW,IAAJ,IAAY,EAA9B;AACAP,QAAOQ,gBAAP,GAA0B,EAA1B;AACAR,QAAOS,gBAAP,GAA0B,KAA1B;;AAEA;AACAX,MAAKY,EAAL,CAAQ,MAAR,EAAgB,EAAEC,QAAQ,SAAV,EAAhB,EAAuC,gBAAQ;;AAE9C,MAAIC,aAAa,IAAIpB,QAAQqB,KAAZ,EAAjB;AACA,MAAIC,UAAUF,WAAWG,gBAAX,CAA4BnB,GAA5B,CAAd;;AAEAkB,UAAQE,OAAR,CAAgBpB,IAAIW,IAApB,EAA0B;AACzBU,gBAAa,IADY;AAEzBd,WAAQ,0CAFiB;AAGzBe,iBAAc;AAHW,GAA1B,EAIG,UAAUC,GAAV,EAAe;AACjB,OAAIA,GAAJ,EAAS;AACRnB,WAAOQ,gBAAP,GAA0BW,IAAIC,MAA9B;AACA,IAFD,MAEO;AACNpB,WAAOS,gBAAP,GAA0B,IAA1B;AACA;AACDY;AACA,GAXD;AAYA,EAjBD;;AAmBAvB,MAAKwB,MAAL,CAAY,SAAZ;AACA,CAjCD","file":"contact.js","sourcesContent":["import keystone from 'keystone';\nconst Enquiry = keystone.list('Enquiry');\n\nexports = module.exports = (req, res) => {\n\n\tvar view = new keystone.View(req, res);\n\tvar locals = res.locals;\n\n\t// Set locals\n\tlocals.section = 'contact';\n\tlocals.enquiryTypes = Enquiry.fields.enquiryType.ops;\n\tlocals.formData = req.body || {};\n\tlocals.validationErrors = {};\n\tlocals.enquirySubmitted = false;\n\n\t// On POST requests, add the Enquiry item to the database\n\tview.on('post', { action: 'contact' }, next => {\n\n\t\tvar newEnquiry = new Enquiry.model();\n\t\tvar updater = newEnquiry.getUpdateHandler(req);\n\n\t\tupdater.process(req.body, {\n\t\t\tflashErrors: true,\n\t\t\tfields: 'name, email, phone, enquiryType, message',\n\t\t\terrorMessage: 'There was a problem submitting your enquiry:',\n\t\t}, function (err) {\n\t\t\tif (err) {\n\t\t\t\tlocals.validationErrors = err.errors;\n\t\t\t} else {\n\t\t\t\tlocals.enquirySubmitted = true;\n\t\t\t}\n\t\t\tnext();\n\t\t});\n\t});\n\n\tview.render('contact');\n};\n"]}